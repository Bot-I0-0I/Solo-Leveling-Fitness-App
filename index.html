<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nebula Command Center</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">

    <!-- Tailwind Config with CSS Variables -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              orbitron: ['Orbitron', 'sans-serif'],
            },
            colors: {
              nebula: {
                950: 'var(--bg-main)',
                900: 'var(--bg-panel)',
                800: 'var(--border-color)',
                600: 'var(--color-primary)',
                500: 'var(--color-primary)',
                400: 'var(--color-secondary)',
                accent: 'var(--color-accent)',
                text: 'var(--color-text)',
                dim: 'var(--color-text-dim)',
                inv: 'var(--color-text-inv)',
              }
            },
            animation: {
              'spin-slow': 'spin 12s linear infinite',
            }
          }
        }
      }
    </script>
  </head>
  <body class="bg-nebula-950 text-nebula-text overflow-hidden selection:bg-nebula-500 selection:text-white">
    
    <!-- App Container -->
    <div id="app" class="flex h-screen relative z-10">
      <!-- Sidebar injected by JS -->
      <aside id="sidebar-container" class="fixed inset-y-0 left-0 z-40 w-64 bg-nebula-950/95 backdrop-blur-xl border-r border-nebula-800 transform -translate-x-full md:translate-x-0 transition-transform duration-300 shadow-2xl"></aside>
      
      <!-- Backdrop for mobile -->
      <div id="mobile-backdrop" class="fixed inset-0 bg-black/60 z-30 hidden md:hidden backdrop-blur-sm" onclick="closeMobileMenu()"></div>

      <!-- Main Content -->
      <main class="flex-1 md:ml-64 flex flex-col h-full overflow-hidden relative">
        <!-- Header injected by JS -->
        <div id="header-container" class="sticky top-0 z-20"></div>

        <!-- View Content -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar">
          <div id="main-content" class="max-w-6xl mx-auto pb-20"></div>
        </div>
        
        <!-- Toast Container -->
        <div id="toast-container" class="fixed bottom-6 right-6 z-50 flex flex-col gap-2 pointer-events-none"></div>
      </main>
    </div>

    <!-- Modals Layer -->
    <div id="modals-layer">
      
      <!-- Mission Modal -->
      <div id="mission-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity">
        <div class="glass-panel rounded-xl p-6 w-full max-w-md shadow-2xl relative animate-fade-in border-t-4 border-t-nebula-500">
          <button onclick="closeModal('mission-modal')" class="absolute top-4 right-4 text-nebula-dim hover:text-nebula-text transition-colors" aria-label="Close"><i data-lucide="x" width="20"></i></button>
          <h3 class="font-orbitron text-xl text-nebula-text mb-6 border-b border-nebula-800 pb-2">Initialize Protocol</h3>
          <form onsubmit="handleAddMission(event)" class="space-y-4">
            <div>
              <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Protocol Name</label>
              <input name="title" placeholder="e.g. Morning Jog" required class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
               <div>
                 <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">XP Reward</label>
                 <input name="points" type="number" placeholder="XP" value="50" required class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
               </div>
               <div>
                 <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Credit Reward</label>
                 <input name="credits" type="number" placeholder="CR" value="25" required class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
               </div>
            </div>
            
            <div>
                 <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Protocol Icon</label>
                 <select name="icon" class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
                   <option value="code">Code</option>
                   <option value="book-open">Read</option>
                   <option value="dumbbell">Workout</option>
                   <option value="brain">Focus</option>
                   <option value="coffee">Break</option>
                   <option value="target">Goal</option>
                   <option value="shield">Defense</option>
                   <option value="zap">Power</option>
                   <option value="swords">Combat</option>
                 </select>
            </div>
            
            <div class="bg-nebula-900/50 p-4 rounded-lg border border-nebula-800">
                <p class="text-xs text-nebula-dim mb-2 font-bold uppercase">Time Window (Optional)</p>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-[10px] text-nebula-dim mb-1">START TIME</label>
                      <input name="startTime" type="time" class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-2 text-nebula-text text-sm focus:border-nebula-500 outline-none">
                    </div>
                    <div>
                      <label class="block text-[10px] text-nebula-dim mb-1">END TIME</label>
                      <input name="endTime" type="time" class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-2 text-nebula-text text-sm focus:border-nebula-500 outline-none">
                    </div>
                </div>
            </div>
            <button type="submit" class="w-full bg-nebula-600 hover:opacity-90 text-white font-bold py-3 rounded-lg mt-4 shadow-lg shadow-nebula-600/20 font-orbitron tracking-widest uppercase text-sm transition-all transform active:scale-95">Initialize</button>
          </form>
        </div>
      </div>

      <!-- Shop Modal -->
      <div id="shop-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity">
        <div class="glass-panel rounded-xl p-6 w-full max-w-md shadow-2xl relative animate-fade-in border-t-4 border-t-nebula-400">
          <button onclick="closeModal('shop-modal')" class="absolute top-4 right-4 text-nebula-dim hover:text-nebula-text transition-colors" aria-label="Close"><i data-lucide="x" width="20"></i></button>
          <h3 class="font-orbitron text-xl text-nebula-text mb-6 border-b border-nebula-800 pb-2">Add Supply Item</h3>
          <form onsubmit="handleAddShopItem(event)" class="space-y-4">
            <div>
               <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Item Name</label>
               <input name="title" placeholder="e.g. Energy Drink" required class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
            </div>
            <div>
               <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Description</label>
               <input name="description" placeholder="Effect description" class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text text-sm focus:border-nebula-500 outline-none">
            </div>
            <div class="grid grid-cols-2 gap-4">
               <div>
                  <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Cost (Credits)</label>
                  <input name="cost" type="number" placeholder="Cost" value="100" required class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
               </div>
               <div>
                  <label class="block text-xs text-nebula-dim mb-1 font-bold uppercase">Icon</label>
                  <select name="icon" class="w-full bg-nebula-950 border border-nebula-800 rounded-lg p-3 text-nebula-text focus:border-nebula-500 outline-none">
                    <option value="coffee">Coffee</option>
                    <option value="gamepad-2">Game</option>
                    <option value="music">Music</option>
                    <option value="pizza">Food</option>
                    <option value="gift">Gift</option>
                    <option value="zap">Energy</option>
                    <option value="monitor">Tech</option>
                    <option value="smile">Fun</option>
                  </select>
               </div>
            </div>
            <div class="flex items-center gap-2 text-sm text-nebula-dim p-3 bg-nebula-900/50 rounded border border-nebula-800">
               <input type="checkbox" name="consumable" id="is_consumable" checked class="w-4 h-4 rounded bg-nebula-950 border-nebula-800 text-nebula-500 focus:ring-nebula-500">
               <label for="is_consumable" class="cursor-pointer select-none">Consumable (One-time use)</label>
            </div>
            <button type="submit" class="w-full bg-nebula-600 hover:opacity-90 text-white font-bold py-3 rounded-lg mt-4 shadow-lg shadow-nebula-600/20 font-orbitron tracking-widest uppercase text-sm transition-all transform active:scale-95">Add to Depot</button>
          </form>
        </div>
      </div>

      <!-- Focus Timer Modal -->
      <div id="focus-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-md transition-opacity">
         <div class="glass-panel rounded-full w-80 h-80 flex flex-col items-center justify-center relative shadow-[0_0_50px_rgba(59,130,246,0.2)] animate-fade-in">
            <button onclick="closeFocusMode()" class="absolute top-8 right-8 text-nebula-dim hover:text-white transition-colors"><i data-lucide="x"></i></button>
            <div class="text-nebula-accent font-orbitron text-sm tracking-widest uppercase mb-2">Focus Mode</div>
            <div id="focus-timer-display" class="text-6xl font-mono font-bold text-nebula-text mb-4">25:00</div>
            <div class="flex gap-4">
              <button id="focus-toggle-btn" onclick="toggleFocusTimer()" class="w-12 h-12 rounded-full bg-nebula-600 text-white flex items-center justify-center hover:scale-110 transition-transform"><i data-lucide="play" width="20"></i></button>
              <button onclick="resetFocusTimer()" class="w-12 h-12 rounded-full bg-nebula-800 text-nebula-dim flex items-center justify-center hover:text-white hover:bg-nebula-700 transition-colors"><i data-lucide="rotate-ccw" width="20"></i></button>
            </div>
            <div id="focus-status" class="absolute bottom-10 text-xs text-nebula-dim">Ready to engage</div>
            
            <!-- Circular Progress SVG -->
            <svg class="absolute inset-0 w-full h-full -rotate-90 pointer-events-none" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="48" fill="none" stroke="var(--border-color)" stroke-width="2" />
              <circle id="focus-progress-circle" cx="50" cy="50" r="48" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="301" stroke-dashoffset="0" class="transition-all duration-1000 ease-linear" />
            </svg>
         </div>
      </div>

    </div>

    <!-- Logic -->
    <script src="script.js"></script>
  </body>
</html>